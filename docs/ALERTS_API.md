# Alerts API Documentation

## Overview
The Alerts API provides endpoints for managing security alerts generated by the surveillance system. It allows creating alerts, retrieving alerts by date, and updating human judgement status.

## Base URL
```
/api/alerts
```

---

## Endpoints

### 1. Create Alert

Creates a new alert with the specified date and video URL.

**Endpoint:** `POST /api/alerts`

**Request Body:**
```json
{
  "alertDate": "2025-12-08T14:30:00",
  "mainVideoUrl": "https://example.com/videos/alert-12345.mp4",
  "productName": "Coffee Beans - Premium Blend",
  "imageUrl": "https://example.com/images/alert-12345.jpg"
}
```

**Request Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `alertDate` | `LocalDateTime` | Yes | The date and time when the alert occurred (ISO 8601 format) |
| `mainVideoUrl` | `String` | Yes | URL to the main video footage of the alert |
| `productName` | `String` | No | Name of the product involved in the alert |
| `imageUrl` | `String` | No | URL to a snapshot image of the alert |

**Response:**
- **Status Code:** `201 Created`
- **Body:** The created Alert object

```json
{
  "id": 1,
  "alertDate": "2025-12-08T14:30:00",
  "mainVideoUrl": "https://example.com/videos/alert-12345.mp4",
  "productName": "Coffee Beans - Premium Blend",
  "imageUrl": "https://example.com/images/alert-12345.jpg",
  "isProcessed": false,
  "secondaryVideoUrl": null,
  "humanJudgement": "NEW",
  "humanJudgementComment": null,
  "createdAt": "2025-12-08T14:30:05",
  "updatedAt": "2025-12-08T14:30:05"
}
```

**Notes:**
- The `humanJudgement` field is automatically set to `NEW` upon creation
- The `isProcessed` field defaults to `false`
- `createdAt` and `updatedAt` timestamps are automatically generated

**Example cURL:**
```bash
curl -X POST http://localhost:8080/api/alerts \
  -H "Content-Type: application/json" \
  -d '{
    "alertDate": "2025-12-08T14:30:00",
    "mainVideoUrl": "https://example.com/videos/alert-12345.mp4",
    "productName": "Coffee Beans - Premium Blend",
    "imageUrl": "https://example.com/images/alert-12345.jpg"
  }'
```

---

### 2. Get Alerts by Date

Retrieves alerts for a specific date or date range.

**Endpoint:** `GET /api/alerts`

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `date` | `LocalDateTime` | Yes | Start date to filter alerts (ISO 8601 format) |
| `endDate` | `LocalDateTime` | No | End date for range queries (ISO 8601 format) |

**Response:**
- **Status Code:** `200 OK`
- **Body:** Array of Alert objects

**Example - Single Date:**
```bash
curl "http://localhost:8080/api/alerts?date=2025-12-08T00:00:00"
```

**Example - Date Range:**
```bash
curl "http://localhost:8080/api/alerts?date=2025-12-08T00:00:00&endDate=2025-12-08T23:59:59"
```

---

### 3. Update Secondary Video and Mark as Processed

Sets the secondary video URL and marks the alert as processed.

**Endpoint:** `PUT /api/alerts/{id}/secondary-video`

**Path Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `Long` | Yes | The ID of the alert to update |

**Request Body:**
```json
{
  "secondaryVideoUrl": "https://example.com/videos/secondary-alert-12345.mp4"
}
```

**Request Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `secondaryVideoUrl` | `String` | Yes | URL to the secondary video footage |

**Response:**
- **Status Code:** `204 NO CONTENT` (if alert found and updated successfully)
- **Status Code:** `404 NOT FOUND` (if alert doesn't exist)
- **Body:** Empty (no content)

**Example cURL:**
```bash
curl -X PUT http://localhost:8080/api/alerts/1/secondary-video \
  -H "Content-Type: application/json" \
  -d '{
    "secondaryVideoUrl": "https://example.com/videos/secondary-alert-12345.mp4"
  }'
```

**Notes:**
- This endpoint automatically sets `isProcessed` to `true`
- The `updatedAt` timestamp is automatically updated via direct query
- This uses a direct database query for efficient updates

---

### 4. Update Human Judgement

Updates the human judgement status for a specific alert using a direct query update.

**Endpoint:** `PATCH /api/alerts/{id}/human-judgement`

**Path Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `Long` | Yes | The ID of the alert to update |

**Request Body:**
```json
{
  "humanJudgement": "TRUE_POSITIVE"
}
```

**Request Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `humanJudgement` | `HumanJudgement` | Yes | The new judgement status |

**Valid HumanJudgement Values:**
- `NEW` - Initial state, not yet reviewed
- `TRUE_POSITIVE` - Confirmed as a genuine alert
- `FALSE_POSITIVE` - Determined to be a false alarm
- `UNKNOWN` - Unable to determine

**Response:**
- **Status Code:** `200 OK` (if alert found and updated)
- **Status Code:** `404 NOT FOUND` (if alert doesn't exist)
- **Body:** The updated Alert object (on success)

**Example cURL:**
```bash
curl -X PATCH http://localhost:8080/api/alerts/1/human-judgement \
  -H "Content-Type: application/json" \
  -d '{
    "humanJudgement": "TRUE_POSITIVE"
  }'
```

**Notes:**
- The `updatedAt` timestamp is automatically updated via direct query
- This uses a direct database query for efficient updates

---

### 5. Get Alert by ID

Retrieves a specific alert by its ID.

**Endpoint:** `GET /api/alerts/{id}`

**Path Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | `Long` | Yes | The ID of the alert to retrieve |

**Response:**
- **Status Code:** `200 OK`
- **Body:** Alert object

**Example cURL:**
```bash
curl http://localhost:8080/api/alerts/1
```

---

### 6. Get All Alerts

Retrieves all alerts in the system.

**Endpoint:** `GET /api/alerts/all`

**Response:**
- **Status Code:** `200 OK`
- **Body:** Array of all Alert objects

**Example cURL:**
```bash
curl http://localhost:8080/api/alerts/all
```

---

## Data Models

### Alert Entity
```java
{
  "id": Long,                        // Primary key
  "alertDate": LocalDateTime,        // When the alert occurred
  "mainVideoUrl": String,            // Main video URL
  "productName": String,             // Product name (optional)
  "imageUrl": String,                // Snapshot image URL (optional)
  "isProcessed": boolean,            // Processing status
  "secondaryVideoUrl": String,       // Optional secondary video
  "humanJudgement": HumanJudgement,  // Review status
  "humanJudgementComment": String,   // Optional review comment
  "createdAt": LocalDateTime,        // Creation timestamp
  "updatedAt": LocalDateTime         // Last update timestamp
}
```

### HumanJudgement Enum
```
NEW              // Not yet reviewed
TRUE_POSITIVE    // Confirmed genuine alert
FALSE_POSITIVE   // False alarm
UNKNOWN          // Unable to determine
```

---

## Error Handling

All endpoints return appropriate HTTP status codes:
- `200 OK` - Successful GET/PATCH request
- `201 Created` - Successful POST request
- `404 Not Found` - Resource not found
- `400 Bad Request` - Invalid request data (validation errors)

**Example Validation Error Response:**
```json
{
  "timestamp": "2025-12-08T14:30:00",
  "status": 400,
  "error": "Bad Request",
  "message": "Validation failed",
  "errors": [
    {
      "field": "alertDate",
      "message": "Alert date is required"
    }
  ]
}
```

